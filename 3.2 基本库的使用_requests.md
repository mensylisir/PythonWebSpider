# Python3网络爬虫课程
## requests
3.2 基本用法
  + 准备工作
  ```
  pip install requests
  ```
  + 简单用法
  ```
  import requests
  response = requests.get('https://www.baidu.com')
  print(type(response))
  print(response.status_code)
  print(type(response.text))
  print(response.text)
  print(response.cookies)
  requests.post('http://httpbin.org/post')
  requests.put('http://httpbin.org/put')
  requests.delete('http://httpbin.org/delete')
  requests.head('http://httpbin.org/head')
  requests.options('http://httpbin.org/options')
  ```
  + GET请求
  ```
  import requests
  response = requests.get('http://httpbin.org/get')
  print(response.text)

  import requests
  response = requests.get('http://httpbin.org/get?name=germey&age=22')
  print(response.text)

  import requests
  data = {
      'name': 'germey',
      'age': 22
  }
  response = requests.get('http://httpbin.org/get', params=data)
  print(response.text)


  import requests
  data = {
      'name': 'germey',
      'age': 22
  }
  response = requests.get('http://httpbin.org/get', params=data)
  print(type(response.text))
  print(response.json())
  print(type(response.json()))

  ```
    - 如果返回结果不是json，调用json()方法会报错，报json解码错误
  + 抓取网页
    - 抓取字符串数据
    ```
    import requests
    import re

    headers = {
        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.169 Safari/537.36'
    }

    response = requests.get('https://www.zhihu.com/explore', headers=headers)
    print(response.text)
    pattern = re.compile(r'a class=\"ExploreSpecialCard-contentTitle\".*?>(.*?)</a>', re.S)
    resut = re.findall(pattern, response.text)
    print(resut)
    ```
    - 抓取二进制数据
    ```
    import requests

    response = requests.get('https://github.com/favicon.ico')
    with open('favicon.ico', 'wb') as f:
        f.write(response.content)

    ```
    - 添加headers
    ```
    import requests


    headers = {
    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.169 Safari/537.36'
    }

    response = requests.get('https://www.zhihu.com/explore', headers=headers)
    print(response.text)
    ```
  + POST请求
  ```
  import requests

  data = {
      'name': 'germey',
      'age': 22
  }

  response = requests.post('http://httpbin.org/post', data=data)
  print(response.text)
  ```
  + 响应
  ```
  import requests
  headers = {
  'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.169 Safari/537.36'
  }
  response = requests.post('http://www.zhihu.com/explore', headers=headers)
  print(response.text)
  print(response.status_code)
  print(response.headers)
  print(type(response.headers))
  print(response.cookies)
  print(type(response.cookies))
  print(response.url)
  print(response.history)
  ```
  + 文件上传
  ```
  import  requests
  file = {
      'file': open('favicon.ico', 'rb')
  }
  response = requests.post('http://httpbin.org/post', files=file)
  print(response.text)
  ```
  + Cookie
    - 获取cookie非常容易方便
    ```
    import  requests
    headers = {
    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.169 Safari/537.36'
    }
    response = requests.get('https://www.baidu.com', headers=headers)
    # print(response.cookies)
    for key, value in response.cookies.items():
        print(key + '=' + value)
    ```
  + 会话维持
  ```
  import requests
  session = requests.Session()
  session.get('http://httpbin.org/cookies/set/number/123456789')
  response = session.get('http://httpbin.org/cookies')
  print(response.text)
  ```
  + SSL
    - verify=False
    ```
    session.get('http://httpbin.org/cookies/set/number/123456789'， verify=False)
    ```
    - 指定证书
    ```
    session.get('http://httpbin.org/cookies/set/number/123456789', cert=('/path/server.crt', '/path/key'))
    ```
  + 代理
  ```
  import requests

  proxy = {
      'http': 'http://127.0.0.1:9999',
      'https': 'https://127.0.0.1:9999',
  }

  requests.get('https://www.baidu.com', proxies=proxy)
  ```
    - 如果代理要HTTPBaseAuth认证
    ```
    import requests
    proxy = {
        'http': 'http://user:password@127.0.0.1:9999/'
    }
    requests.get('https://www.baidu.com', proxies=proxy)
    ```
    - socket代理
      ```
      pip install requests[socks]
      ```
  + 超时
  ```
  import requests
  response = requests.get('https://www.taobao.com', timeout=0.00001)
  print(response.status_code)
  ```
  + 身份认证
  ```
  import requests
  from requests.auth import HTTPBasicAuth

  response = requests.get('http://localhost:8080', auth=HTTPBasicAuth('username', 'password'))
  print(response.text)
  ```
    - OAuth
    ```
    pip install requests-oauthlib
    ```
  + Prepared Request
  
